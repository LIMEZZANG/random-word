<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Random Word Viewer</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
      color: #333;
    }
    h2 {
      margin-top: 40px;
      margin-bottom: 10px;
    }
    button {
      font-size: 0.9rem;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      margin-right: 8px;
    }
    button:hover {
      background-color: #45a049;
    }
    input[type="file"], input[type="number"] {
      padding: 6px;
      font-size: 0.9rem;
      margin-top: 6px;
    }
    #wordDisplay {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
    }
    .line {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .word {
      background: #ffffff;
      padding: 10px 16px;
      border-radius: 12px;
      margin: 5px;
      cursor: pointer;
      transition: 0.2s;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .word.first {
      font-size: 1.8rem;
      font-weight: bold;
    }
    .word.clicked {
      background: #ffe5e5;
      color: red;
    }
    .meaning {
      font-size: 1rem;
      color: inherit;
      margin-top: 5px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .file-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #wordCounter {
      font-weight: bold;
      font-size: 0.95rem;
    }
    #listInfo {
      margin-top: 20px;
      font-size: 0.95rem;
      color: #666;
    }
    textarea {
      width: 100%;
      height: 100px;
      margin-top: 10px;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <h1>üìò ÎûúÎç§ Îã®Ïñ¥ Ï∂úÎ†•Í∏∞</h1>
  <div class="top-bar">
    <div class="controls">
      <button onclick="startDisplay()">Start</button>
      <button onclick="stopDisplay()">Stop</button>
      <button onclick="resetDisplay()">Reset</button>
      <label>‚è± <input id="intervalInput" type="number" min="0.1" max="5" step="0.1" value="0.7"> Ï¥à</label>
      <div id="wordCounter"></div>
    </div>
    <div class="file-actions">
      <input type="file" id="importFile" onchange="importData(event)">
      <button style="background-color:#2196F3; padding: 6px 10px; font-size: 0.85rem;" onclick="exportData()">ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
    </div>
  </div>
  <div id="listInfo"></div>
  <div id="wordDisplay"></div>

  <h2>üì¶ Î™©Î°ù Ï∂îÍ∞Ä</h2>
  <input type="text" id="listName" placeholder="Ïòà: 2ÏùºÏ∞®">
  <textarea id="wordInput" placeholder="Îã®Ïñ¥,Îúª ÌòïÏãùÏúºÎ°ú Ï§ÑÎ∞îÍøàÌïòÏó¨ ÏûÖÎ†•"></textarea>
  <button onclick="addList()">‚ûï Î™©Î°ù Ï∂îÍ∞Ä</button>
  
  <h2>üìÇ Î™©Î°ù ÏÑ†ÌÉù</h2>
  <div id="listSelection"></div>

  <script>
    let wordLists = {
      "1ÏùºÏ∞®": [
        ["fund", "Í∏∞Î∞ò"], ["fus", "ÏÑûÏù¥Îã§"], ["gar", "ÎçÆÎã§"], ["gard", "ÏßÄÏºúÎ≥¥Îã§"],
        ["gener", "ÌÉúÏÉùÏùò"], ["gest", "Ïö¥Î∞òÌïòÎã§"], ["grad", "Îã®Í≥Ñ"], ["grat", "Í∏∞ÏÅ®"],
        ["grav", "Î¨¥Í±∞Ïö¥"], ["hab", "Í∞ÄÏßÄÎã§"], ["hand", "ÏÜê"], ["hap", "Ïö¥"],
        ["heal", "ÏôÑÏ†ÑÌïú"], ["hered", "ÏÉÅÏÜçÏù∏"], ["horr", "Îñ®Îã§"], ["host", "ÏÜêÎãò"],
        ["hum", "ÎïÖ"], ["ide", "Î≥¥Îã§"], ["insula", "ÏÑ¨"], ["it", "Í∞ÄÎã§"]
      ]
    };

    let selectedLists = new Set(["1ÏùºÏ∞®"]);
    let remainingWords = [];
    let displayedWords = [];
    let timer = null;
    let clickedWords = new Set();

    function startDisplay() {
      if (timer) return;
      if (remainingWords.length === 0 && displayedWords.length > 0) {
        resetDisplay();
      }
      if (remainingWords.length === 0) {
        selectedLists.forEach(name => {
          remainingWords.push(...wordLists[name]);
        });
        remainingWords = shuffle(remainingWords);
        updateListInfo();
      }
      if (remainingWords.length === 0) return;

      const interval = parseFloat(document.getElementById('intervalInput').value) * 1000;
      timer = setInterval(() => {
        if (remainingWords.length === 0) {
          stopDisplay();
          return;
        }
        const word = remainingWords.shift();
        displayedWords.unshift(word);
        updateDisplay();
      }, interval);
    }

    function stopDisplay() {
      clearInterval(timer);
      timer = null;
    }

    function resetDisplay() {
      stopDisplay();
      remainingWords = [];
      displayedWords = [];
      clickedWords.clear();
      updateDisplay();
      updateListInfo();
    }

    function updateDisplay() {
      const displayDiv = document.getElementById('wordDisplay');
      displayDiv.innerHTML = '';
      let redCount = 0;

      if (displayedWords.length > 0) {
        const firstLine = document.createElement('div');
        firstLine.className = 'line';
        const firstEntry = displayedWords[0];
        const [word, meaning] = Array.isArray(firstEntry) ? firstEntry : [firstEntry, ''];
        const el = document.createElement('div');
        el.className = 'word first';
        if (clickedWords.has(word)) {
          el.classList.add('clicked');
          redCount++;
        }
        const wordText = document.createElement('div');
        wordText.textContent = word;
        el.appendChild(wordText);
        if (clickedWords.has(word) && meaning) {
          const m = document.createElement('div');
          m.className = 'meaning';
          m.textContent = meaning;
          el.appendChild(m);
        }
        el.onclick = () => {
          stopDisplay();
          clickedWords.add(word);
          updateDisplay();
        };
        firstLine.appendChild(el);
        displayDiv.appendChild(firstLine);
      }

      const restLine = document.createElement('div');
      restLine.className = 'line';
      for (let i = 1; i < displayedWords.length; i++) {
        const [word, meaning] = Array.isArray(displayedWords[i]) ? displayedWords[i] : [displayedWords[i], ''];
        const el = document.createElement('div');
        el.className = 'word';
        if (clickedWords.has(word)) {
          el.classList.add('clicked');
          redCount++;
        }
        const wordText = document.createElement('div');
        wordText.textContent = word;
        el.appendChild(wordText);
        if (clickedWords.has(word) && meaning) {
          const m = document.createElement('div');
          m.className = 'meaning';
          m.textContent = meaning;
          el.appendChild(m);
        }
        el.onclick = () => {
          stopDisplay();
          clickedWords.add(word);
          updateDisplay();
        };
        restLine.appendChild(el);
      }
      displayDiv.appendChild(restLine);

      const counter = document.getElementById('wordCounter');
      if (counter) {
        counter.textContent = `${redCount}/${displayedWords.length}/${displayedWords.length + remainingWords.length}`;
      }
    }

    function updateListInfo() {
  const info = document.getElementById('listInfo');
  if (!info) return;
  const listNames = [...selectedLists].join(', ');
  info.textContent = `ÏÇ¨Ïö© Ï§ëÏù∏ Î™©Î°ù: ${listNames}`;

  const selectionDiv = document.getElementById('listSelection');
  selectionDiv.innerHTML = '';
  Object.keys(wordLists).forEach(name => {
    const label = document.createElement('label');
    label.style.marginRight = '10px';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.checked = selectedLists.has(name);
    checkbox.onchange = () => {
      if (checkbox.checked) {
        selectedLists.add(name);
      } else {
        selectedLists.delete(name);
      }
      updateListInfo();
    };

    const editBtn = document.createElement('button');
    editBtn.textContent = '‚úè';
    editBtn.style.marginLeft = '5px';
    editBtn.onclick = () => {
      document.getElementById('listName').value = name;
      document.getElementById('wordInput').value = wordLists[name].map(([w, m]) => `${w},${m}`).join('\n');
    };

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'üóë';
    deleteBtn.onclick = () => {
      delete wordLists[name];
      selectedLists.delete(name);
      saveToLocalStorage();
      resetDisplay();
      updateListInfo();
    };

    label.appendChild(checkbox);
    label.appendChild(document.createTextNode(name));
    label.appendChild(editBtn);
    label.appendChild(deleteBtn);
    selectionDiv.appendChild(label);
  });
}
    // Î™©Î°ù Ï∂îÍ∞Ä Ïãú Í∏∞Ï°¥Í≥º Ï§ëÎ≥µÎêòÎ©¥ ÎçÆÏñ¥Ïì∞Í∏∞Îê®
function addList() {
  const name = document.getElementById('listName').value.trim();
  const lines = document.getElementById('wordInput').value
    .split('\n')
    .map(line => line.trim())
    .filter(line => line.length > 0);

  const entries = lines.map(line => {
    const [word, ...meaningParts] = line.split(',');
    return [word.trim(), meaningParts.join(',').trim()];
  });

  if (name && entries.length > 0) {
    wordLists[name] = entries;
    selectedLists.add(name);
    saveToLocalStorage();
    resetDisplay();
    updateListInfo();
  }
}
    function exportData() {
      const blob = new Blob([JSON.stringify(wordLists, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const now = new Date();
      const pad = n => n.toString().padStart(2, '0');
      const filename = `wordlists_${now.getFullYear().toString().slice(2)}${pad(now.getMonth()+1)}${pad(now.getDate())}${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}.json`;
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          if (typeof data === 'object') {
            wordLists = data;
            saveToLocalStorage();
            selectedLists = new Set(Object.keys(wordLists));
            resetDisplay();
          }
        } catch (err) {
          alert('Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùÄ ÌååÏùºÏûÖÎãàÎã§.');
        }
      };
      reader.readAsText(file);
    }

    function saveToLocalStorage() {
      localStorage.setItem('wordLists', JSON.stringify(wordLists));
    }

    function addList() {
      const name = document.getElementById('listName').value.trim();
      const lines = document.getElementById('wordInput').value
        .split('\n')
        .map(line => line.trim())
        .filter(line => line.length > 0);

      const entries = lines.map(line => {
        const [word, ...meaningParts] = line.split(',');
        return [word.trim(), meaningParts.join(',').trim()];
      });

      if (name && entries.length > 0) {
        wordLists[name] = entries;
        selectedLists = new Set([name]);
        saveToLocalStorage();
        resetDisplay();
      }
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
  </script>
</body>
</html>
