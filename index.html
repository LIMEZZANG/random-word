<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Random Word Viewer</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
      color: #333;
    }
    h2 {
      margin-top: 40px;
      margin-bottom: 10px;
    }
    button {
      font-size: 0.9rem;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      margin-right: 8px;
    }
    button:hover {
      background-color: #45a049;
    }
    input[type="file"] {
      padding: 6px;
      font-size: 0.9rem;
      margin-top: 6px;
    }
    #wordDisplay {
      margin-top: 20px;
    }
    .word {
      background: #ffffff;
      padding: 10px 16px;
      border-radius: 12px;
      margin: 5px;
      display: inline-block;
      cursor: pointer;
      transition: 0.2s;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .word.first {
      font-size: 6.0rem;
      font-weight: bold;
    }
    .word.clicked {
      background: #ffe5e5;
      color: red;
    }
    .meaning {
      font-size: 1rem;
      color: inherit;
      margin-top: 5px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .file-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #wordCounter {
      font-weight: bold;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <h1>üìò ÎûúÎç§ Îã®Ïñ¥ Ï∂úÎ†•Í∏∞</h1>
  <div class="top-bar">
    <div class="controls">
      <button onclick="startDisplay()">Start</button>
      <button onclick="stopDisplay()">Stop</button>
      <button onclick="resetDisplay()">Reset</button>
      <div id="wordCounter"></div>
    </div>
    <div class="file-actions">
      <input type="file" id="importFile" onchange="importData(event)">
      <button style="background-color:#2196F3; padding: 6px 10px; font-size: 0.85rem;" onclick="exportData()">ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
    </div>
  </div>
  <div id="wordDisplay"></div>

  <script>
    let wordLists = {
      "1ÏùºÏ∞®": [
        ["fund", "Í∏∞Î∞ò"], ["fus", "ÏÑûÏù¥Îã§"], ["gar", "ÎçÆÎã§"], ["gard", "ÏßÄÏºúÎ≥¥Îã§"],
        ["gener", "ÌÉúÏÉùÏùò"], ["gest", "Ïö¥Î∞òÌïòÎã§"], ["grad", "Îã®Í≥Ñ"], ["grat", "Í∏∞ÏÅ®"],
        ["grav", "Î¨¥Í±∞Ïö¥"], ["hab", "Í∞ÄÏßÄÎã§"], ["hand", "ÏÜê"], ["hap", "Ïö¥"],
        ["heal", "ÏôÑÏ†ÑÌïú"], ["hered", "ÏÉÅÏÜçÏù∏"], ["horr", "Îñ®Îã§"], ["host", "ÏÜêÎãò"],
        ["hum", "ÎïÖ"], ["ide", "Î≥¥Îã§"], ["insula", "ÏÑ¨"], ["it", "Í∞ÄÎã§"]
      ]
    };

    let selectedLists = new Set(["1ÏùºÏ∞®"]);
    let remainingWords = [];
    let displayedWords = [];
    let timer = null;
    let clickedWords = new Set();

    function startDisplay() {
      if (timer) return;
      if (remainingWords.length === 0 && displayedWords.length > 0) {
        resetDisplay();
      }
      if (remainingWords.length === 0) {
        selectedLists.forEach(name => {
          remainingWords.push(...wordLists[name]);
        });
        remainingWords = shuffle(remainingWords);
      }
      if (remainingWords.length === 0) return;

      const interval = 700;
      timer = setInterval(() => {
        if (remainingWords.length === 0) {
          stopDisplay();
          return;
        }
        const word = remainingWords.shift();
        displayedWords.unshift(word);
        updateDisplay();
      }, interval);
    }

    function stopDisplay() {
      clearInterval(timer);
      timer = null;
    }

    function resetDisplay() {
      stopDisplay();
      remainingWords = [];
      displayedWords = [];
      clickedWords.clear();
      updateDisplay();
    }

    function updateDisplay() {
      const displayDiv = document.getElementById('wordDisplay');
      displayDiv.innerHTML = '';
      let redCount = 0;

      displayedWords.forEach((entry, index) => {
        const [word, meaning] = Array.isArray(entry) ? entry : [entry, ''];
        const el = document.createElement('div');
        el.className = 'word';
        if (index === 0) el.classList.add('first');
        if (clickedWords.has(word)) {
          el.classList.add('clicked');
          redCount++;
        }

        const wordText = document.createElement('div');
        wordText.textContent = word;
        el.appendChild(wordText);

        if (clickedWords.has(word) && meaning) {
          const m = document.createElement('div');
          m.className = 'meaning';
          m.textContent = meaning;
          el.appendChild(m);
        }

        el.onclick = () => {
          stopDisplay();
          clickedWords.add(word);
          updateDisplay();
        };

        displayDiv.appendChild(el);
      });

      const counter = document.getElementById('wordCounter');
      if (counter) {
        counter.textContent = `${displayedWords.length - redCount}/${displayedWords.length}`;
      }
    }

    function exportData() {
      const blob = new Blob([JSON.stringify(wordLists, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const now = new Date();
      const pad = n => n.toString().padStart(2, '0');
      const filename = `wordlists_${now.getFullYear().toString().slice(2)}${pad(now.getMonth()+1)}${pad(now.getDate())}${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}.json`;
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          if (typeof data === 'object') {
            wordLists = data;
            saveToLocalStorage();
            selectedLists = new Set(Object.keys(wordLists));
            resetDisplay();
          }
        } catch (err) {
          alert('Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùÄ ÌååÏùºÏûÖÎãàÎã§.');
        }
      };
      reader.readAsText(file);
    }

    function saveToLocalStorage() {
      localStorage.setItem('wordLists', JSON.stringify(wordLists));
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
  </script>
</body>
</html>
